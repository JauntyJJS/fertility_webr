---
title: "webr_quarto_test"
format:
  html:
    toc: true
    toc-location: left
    toc-expand: true
    smooth-scroll: true
    freeze: false
    highlight-style:
      light: github
      dark: github-dark
    theme:
      light:
        - flatly
        #- custom.scss
      dark:
        - solar
engine: knitr
filters:
  - webr
webr:
  packages: ['readr', 'dplyr', 'tidyr', 'forcats', 'reactable']
---

# Load R Packages Interactively

```{r}
#| label: Load R Packages
#| message: false
#| warning: false

library("readr")
library("dplyr")
library("tidyr")
library("forcats")
library("reactable")
```

# Load Data

We read in the data using `readr::read_csv`

```{webr-r}
#| label: Load Data
#| context: setup

download.file(
  url = "https://raw.githubusercontent.com/JauntyJJS/fertility_webr/main/data/Fertility%20Rate%20By%20Ethnic%20Group%2C%20Yearly.csv",
  destfile = "Fertility Rate By Ethnic Group, Yearly.csv",
  quiet = TRUE)

fertility_rate_data <- readr::read_csv(
  file = "Fertility Rate By Ethnic Group, Yearly.csv",
  col_names = TRUE,
  show_col_types = FALSE
)

```


```{webr-r}
#| label: View Data

fertility_rate_data
  reactable::reactable(
    defaultPageSize = 5,
    paginationType = "jump"
  )
```

# Prepare Data For Plot

```{webr-r}
#| label: prepare data

fertility_rate_data_year <- fertility_rate_data |> 
  tidyr::pivot_longer(
    cols = -c("Ethnicity"),
    names_to = c("Year"),
    values_to = "Total_Fertility_Rate_Per_Female"
  ) |> 
  dplyr::mutate(
    Ethnicity = dplyr::case_when(
      .data[["Ethnicity"]] == "Chinese (Per Female)" ~ "Chinese",
      .data[["Ethnicity"]] == "Malays (Per Female)" ~ "Malays",
      .data[["Ethnicity"]] == "Indians (Per Female)" ~ "Indians",
      .data[["Ethnicity"]] == "All (Per Female)" ~ "Total*",
    ),
    Ethnicity = forcats::fct_relevel(
      .data[["Ethnicity"]],
      c("Chinese", "Malays", "Indians", "Total*")
    )
  ) |> 
  dplyr::filter(
    .data[["Year"]] >= 1980
  )

fertility_rate_data
```
